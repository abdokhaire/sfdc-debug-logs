(function(){function c(g){return g.replace(/^\s+|\s+$/g,"")}function e(g){return g.replace(/^\s+/g,"")}function f(g){return g.replace(/\s+$/g,"")}function a(q,i,g,o){var B,C,A,l,z,v,k,s,n,E,F;i=i||{};if((i.wrap_line_length===undefined||parseInt(i.wrap_line_length,10)===0)&&(i.max_char!==undefined&&parseInt(i.max_char,10)!==0)){i.wrap_line_length=i.max_char}C=(i.indent_inner_html===undefined)?false:i.indent_inner_html;A=(i.indent_size===undefined)?4:parseInt(i.indent_size,10);l=(i.indent_char===undefined)?" ":i.indent_char;v=(i.brace_style===undefined)?"collapse":i.brace_style;z=parseInt(i.wrap_line_length,10)===0?32786:parseInt(i.wrap_line_length||250,10);k=i.unformatted||["a","span","img","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"];s=(i.preserve_newlines===undefined)?true:i.preserve_newlines;n=s?(isNaN(parseInt(i.max_preserve_newlines,10))?32786:parseInt(i.max_preserve_newlines,10)):0;E=(i.indent_handlebars===undefined)?false:i.indent_handlebars;F=(i.end_with_newline===undefined)?false:i.end_with_newline;function j(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",parentcount:1,parent1:""};this.tag_type="";this.token_text=this.last_token=this.last_text=this.token_type="";this.newlines=0;this.indent_content=C;this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(K,t){for(var J=0;J<t.length;J++){if(K===t[J]){return true}}return false}};this.is_whitespace=function(t){for(var J=0;J<t.length;t++){if(!this.Utils.in_array(t.charAt(J),this.Utils.whitespace)){return false}}return true};this.traverse_whitespace=function(){var t="";t=this.input.charAt(this.pos);if(this.Utils.in_array(t,this.Utils.whitespace)){this.newlines=0;while(this.Utils.in_array(t,this.Utils.whitespace)){if(s&&t==="\n"&&this.newlines<=n){this.newlines+=1}this.pos++;t=this.input.charAt(this.pos)}return true}return false};this.space_or_wrap=function(t){if(this.line_char_count>=this.wrap_line_length){this.print_newline(false,t);this.print_indentation(t)}else{this.line_char_count++;t.push(" ")}};this.get_content=function(){var L="",J=[],t=false;while(this.input.charAt(this.pos)!=="<"){if(this.pos>=this.input.length){return J.length?J.join(""):["","TK_EOF"]}if(this.traverse_whitespace()){this.space_or_wrap(J);continue}if(E){var K=this.input.substr(this.pos,3);if(K==="{{#"||K==="{{/"){break}else{if(this.input.substr(this.pos,2)==="{{"){if(this.get_tag(true)==="{{else}}"){break}}}}L=this.input.charAt(this.pos);this.pos++;this.line_char_count++;J.push(L)}return J.length?J.join(""):""};this.get_contents_to=function(N){if(this.pos===this.input.length){return["","TK_EOF"]}var t="";var L="";var M=new RegExp("</"+N+"\\s*>","igm");M.lastIndex=this.pos;var K=M.exec(this.input);var J=K?K.index:this.input.length;if(this.pos<J){L=this.input.substring(this.pos,J);this.pos=J}return L};this.record_tag=function(t){if(this.tags[t+"count"]){this.tags[t+"count"]++;this.tags[t+this.tags[t+"count"]]=this.indent_level}else{this.tags[t+"count"]=1;this.tags[t+this.tags[t+"count"]]=this.indent_level}this.tags[t+this.tags[t+"count"]+"parent"]=this.tags.parent;this.tags.parent=t+this.tags[t+"count"]};this.retrieve_tag=function(t){if(this.tags[t+"count"]){var J=this.tags.parent;while(J){if(t+this.tags[t+"count"]===J){break}J=this.tags[J+"parent"]}if(J){this.indent_level=this.tags[t+this.tags[t+"count"]];this.tags.parent=this.tags[J+"parent"]}delete this.tags[t+this.tags[t+"count"]+"parent"];delete this.tags[t+this.tags[t+"count"]];if(this.tags[t+"count"]===1){delete this.tags[t+"count"]}else{this.tags[t+"count"]--}}};this.indent_to_tag=function(t){if(!this.tags[t+"count"]){return}var J=this.tags.parent;while(J){if(t+this.tags[t+"count"]===J){break}J=this.tags[J+"parent"]}if(J){this.indent_level=this.tags[t+this.tags[t+"count"]]}};this.get_tag=function(L){var Q="",P=[],S="",M=false,U,O,R,t=this.pos,V=this.line_char_count;L=L!==undefined?L:false;do{if(this.pos>=this.input.length){if(L){this.pos=t;this.line_char_count=V}return P.length?P.join(""):["","TK_EOF"]}Q=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(Q,this.Utils.whitespace)){M=true;continue}if(Q==="'"||Q==='"'){Q+=this.get_unformatted(Q);M=true}if(Q==="="){M=false}if(P.length&&P[P.length-1]!=="="&&Q!==">"&&M){this.space_or_wrap(P);M=false}if(E&&R==="<"){if((Q+this.input.charAt(this.pos))==="{{"){Q+=this.get_unformatted("}}");if(P.length&&P[P.length-1]!==" "&&P[P.length-1]!=="<"){Q=" "+Q}M=true}}if(Q==="<"&&!R){U=this.pos-1;R="<"}if(E&&!R){if(P.length>=2&&P[P.length-1]==="{"&&P[P.length-2]=="{"){if(Q==="#"||Q==="/"){U=this.pos-3}else{U=this.pos-2}R="{"}}this.line_char_count++;P.push(Q);if(P[1]&&P[1]==="!"){P=[this.get_comment(U)];break}if(E&&R==="{"&&P.length>2&&P[P.length-2]==="}"&&P[P.length-1]==="}"){break}}while(Q!==">");var T=P.join("");var J;var K;if(T.indexOf(" ")!==-1){J=T.indexOf(" ")}else{if(T[0]==="{"){J=T.indexOf("}")}else{J=T.indexOf(">")}}if(T[0]==="<"||!E){K=1}else{K=T[2]==="#"?3:2}var N=T.substring(K,J).toLowerCase();if(T.charAt(T.length-2)==="/"||this.Utils.in_array(N,this.Utils.single_token)){if(!L){this.tag_type="SINGLE"}}else{if(E&&T[0]==="{"&&N==="else"){if(!L){this.indent_to_tag("if");this.tag_type="HANDLEBARS_ELSE";this.indent_content=true;this.traverse_whitespace()}}else{if(this.is_unformatted(N,k)){S=this.get_unformatted("</"+N+">",T);P.push(S);O=this.pos-1;this.tag_type="SINGLE"}else{if(N==="script"&&(T.search("type")===-1||(T.search("type")>-1&&T.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/)>-1))){if(!L){this.record_tag(N);this.tag_type="SCRIPT"}}else{if(N==="style"&&(T.search("type")===-1||(T.search("type")>-1&&T.search("text/css")>-1))){if(!L){this.record_tag(N);this.tag_type="STYLE"}}else{if(N.charAt(0)==="!"){if(!L){this.tag_type="SINGLE";this.traverse_whitespace()}}else{if(!L){if(N.charAt(0)==="/"){this.retrieve_tag(N.substring(1));this.tag_type="END"}else{this.record_tag(N);if(N.toLowerCase()!=="html"){this.indent_content=true}this.tag_type="START"}if(this.traverse_whitespace()){this.space_or_wrap(P)}if(this.Utils.in_array(N,this.Utils.extra_liners)){this.print_newline(false,this.output);if(this.output.length&&this.output[this.output.length-2]!=="\n"){this.print_newline(true,this.output)}}}}}}}}}if(L){this.pos=t;this.line_char_count=V}return P.join("")};this.get_comment=function(K){var t="",J=">",L=false;this.pos=K;input_char=this.input.charAt(this.pos);this.pos++;while(this.pos<=this.input.length){t+=input_char;if(t[t.length-1]===J[J.length-1]&&t.indexOf(J)!==-1){break}if(!L&&t.length<10){if(t.indexOf("<![if")===0){J="<![endif]>";L=true}else{if(t.indexOf("<![cdata[")===0){J="]]>";L=true}else{if(t.indexOf("<![")===0){J="]>";L=true}else{if(t.indexOf("<!--")===0){J="-->";L=true}}}}}input_char=this.input.charAt(this.pos);this.pos++}return t};this.get_unformatted=function(L,J){if(J&&J.toLowerCase().indexOf(L)!==-1){return""}var t="";var K="";var N=0;var M=true;do{if(this.pos>=this.input.length){return K}t=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(t,this.Utils.whitespace)){if(!M){this.line_char_count--;continue}if(t==="\n"||t==="\r"){K+="\n";this.line_char_count=0;continue}}K+=t;this.line_char_count++;M=true;if(E&&t==="{"&&K.length&&K[K.length-2]==="{"){K+=this.get_unformatted("}}");N=K.length}}while(K.toLowerCase().indexOf(L,N)===-1);return K};this.get_token=function(){var J;if(this.last_token==="TK_TAG_SCRIPT"||this.last_token==="TK_TAG_STYLE"){var K=this.last_token.substr(7);J=this.get_contents_to(K);if(typeof J!=="string"){return J}return[J,"TK_"+K]}if(this.current_mode==="CONTENT"){J=this.get_content();if(typeof J!=="string"){return J}else{return[J,"TK_CONTENT"]}}if(this.current_mode==="TAG"){J=this.get_tag();if(typeof J!=="string"){return J}else{var t="TK_TAG_"+this.tag_type;return[J,t]}}};this.get_full_indent=function(t){t=this.indent_level+t||0;if(t<1){return""}return Array(t+1).join(this.indent_string)};this.is_unformatted=function(t,L){if(!this.Utils.in_array(t,L)){return false}if(t.toLowerCase()!=="a"||!this.Utils.in_array("a",L)){return true}var K=this.get_tag(true);var J=(K||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);if(!J||this.Utils.in_array(J,L)){return true}else{return false}};this.printer=function(K,L,t,J,N){this.input=K||"";this.output=[];this.indent_character=L;this.indent_string="";this.indent_size=t;this.brace_style=N;this.indent_level=0;this.wrap_line_length=J;this.line_char_count=0;for(var M=0;M<this.indent_size;M++){this.indent_string+=this.indent_character}this.print_newline=function(O,P){this.line_char_count=0;if(!P||!P.length){return}if(O||(P[P.length-1]!=="\n")){if((P[P.length-1]!=="\n")){P[P.length-1]=f(P[P.length-1])}P.push("\n")}};this.print_indentation=function(P){for(var O=0;O<this.indent_level;O++){P.push(this.indent_string);this.line_char_count+=this.indent_string.length}};this.print_token=function(O){if(this.is_whitespace(O)&&!this.output.length){return}if(O||O!==""){if(this.output.length&&this.output[this.output.length-1]==="\n"){this.print_indentation(this.output);O=e(O)}}this.print_token_raw(O)};this.print_token_raw=function(O){if(this.newlines>0){O=f(O)}if(O&&O!==""){if(O.length>1&&O[O.length-1]==="\n"){this.output.push(O.slice(0,-1));this.print_newline(false,this.output)}else{this.output.push(O)}}for(var P=0;P<this.newlines;P++){this.print_newline(P>0,this.output)}this.newlines=0};this.indent=function(){this.indent_level++};this.unindent=function(){if(this.indent_level>0){this.indent_level--}}};return this}B=new j();B.printer(q,l,A,z,v);while(true){var u=B.get_token();B.token_text=u[0];B.token_type=u[1];if(B.token_type==="TK_EOF"){break}switch(B.token_type){case"TK_TAG_START":B.print_newline(false,B.output);B.print_token(B.token_text);if(B.indent_content){B.indent();B.indent_content=false}B.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":B.print_newline(false,B.output);B.print_token(B.token_text);B.current_mode="CONTENT";break;case"TK_TAG_END":if(B.last_token==="TK_CONTENT"&&B.last_text===""){var H=B.token_text.match(/\w+/)[0];var p=null;if(B.output.length){p=B.output[B.output.length-1].match(/(?:<|{{#)\s*(\w+)/)}if(p===null||p[1]!==H){B.print_newline(false,B.output)}}B.print_token(B.token_text);B.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var D=B.token_text.match(/^\s*<([a-z-]+)/i);if(!D||!B.Utils.in_array(D[1],k)){B.print_newline(false,B.output)}B.print_token(B.token_text);B.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_ELSE":B.print_token(B.token_text);if(B.indent_content){B.indent();B.indent_content=false}B.current_mode="CONTENT";break;case"TK_CONTENT":B.print_token(B.token_text);B.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(B.token_text!==""){B.print_newline(false,B.output);var w=B.token_text,y,h=1;if(B.token_type==="TK_SCRIPT"){y=typeof g==="function"&&g}else{if(B.token_type==="TK_STYLE"){y=typeof o==="function"&&o}}if(i.indent_scripts==="keep"){h=0}else{if(i.indent_scripts==="separate"){h=-B.indent_level}}var I=B.get_full_indent(h);if(y){w=y(w.replace(/^\s*/,I),i)}else{var x=w.match(/^\s*/)[0];var m=x.match(/[^\n\r]*$/)[0].split(B.indent_string).length-1;var r=B.get_full_indent(h-m);w=w.replace(/^\s*/,I).replace(/\r\n|\r|\n/g,"\n"+r).replace(/\s+$/,"")}if(w){B.print_token_raw(w);B.print_newline(true,B.output)}}B.current_mode="TAG";break;default:if(B.token_text!==""){B.print_token(B.token_text)}break}B.last_token=B.token_type;B.last_text=B.token_text}var G=B.output.join("").replace(/[\r\n\t ]+$/,"");if(F){G+="\n"}return G}if(typeof define==="function"&&define.amd){define(["require","./beautify","./beautify-css"],function(g){var h=g("./beautify");var i=g("./beautify-css");return{html_beautify:function(j,k){return a(j,k,h.js_beautify,i.css_beautify)}}})}else{if(typeof exports!=="undefined"){var b=require("./beautify.js");var d=require("./beautify-css.js");exports.html_beautify=function(g,h){return a(g,h,b.js_beautify,d.css_beautify)}}else{if(typeof window!=="undefined"){window.html_beautify=function(g,h){return a(g,h,window.js_beautify,window.css_beautify)}}else{if(typeof global!=="undefined"){global.html_beautify=function(g,h){return a(g,h,global.js_beautify,global.css_beautify)}}}}}}());